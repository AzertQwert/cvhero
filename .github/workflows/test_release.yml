name: test_release
on:
  pull_request:
    branches: [main]
    
  workflow_dispatch:
    
jobs:
  get_version_number:
    runs-on: ubuntu-latest
      
    env:
      NEWV: ""
      OLDV: ""
      
    steps:
      - uses: actions/checkout@v3
      
      - name: get_new_version
        run: | 
          echo "NEWV=$(grep "~" docs/change_log.rst -m1 -a1 | sed 1q | cut -d" " -f1)" >> $GITHUB_ENV
          
      - name: get_current_version
        run: | 
          echo "OLDV=$(grep "VERSION" -m1 setup.py | cut -d"=" -f2 | sed "s/['\" ]//g")" >> $GITHUB_ENV
          
      - name: verify
        if: ${{ env.NEWV == env.OLDV }}
        run: echo you did not update the change_log && exit 1
